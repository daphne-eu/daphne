
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../InstallPythonLibsInContainer/">
      
      
        <link rel="next" href="../PropertyRecording/">
      
      
      <link rel="icon" href="../../assets/logo_small.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>PropertyInference - DAPHNE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-properties-representation-inference-and-exploitation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DAPHNE" class="md-header__button md-logo" aria-label="DAPHNE" data-md-component="logo">
      
  <img src="../../assets/logo_small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DAPHNE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PropertyInference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/daphne-eu/daphne" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    daphne-eu/daphne
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../RunningDaphneLocally/" class="md-tabs__link">
          
  
  
  Users

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Contributing/" class="md-tabs__link">
          
  
  
  Developers

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DAPHNE" class="md-nav__button md-logo" aria-label="DAPHNE" data-md-component="logo">
      
  <img src="../../assets/logo_small.png" alt="logo">

    </a>
    DAPHNE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/daphne-eu/daphne" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    daphne-eu/daphne
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GettingStarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GettingStarted
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Users
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Users
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RunningDaphneLocally/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RunningDaphneLocally
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DaphneDSL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            DaphneDSL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneDSL/LanguageRef/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LanguageRef
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneDSL/Builtins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Builtins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneDSL/Imports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imports
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DaphneLib
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            DaphneLib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneLib/Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneLib/APIRef/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    APIRef
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DaphneLib/Numpy2DaphneLib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Numpy2DaphneLib
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../FileMetaDataFormat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileMetaDataFormat
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DistributedRuntime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DistributedRuntime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SchedulingOptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SchedulingOptions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/sqlTutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sqlTutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../FPGAconfiguration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FPGAconfiguration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MPI-Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MPI Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profiling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Extensions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BuildingDaphne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BuildingDaphne
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ReleaseScripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ReleaseScripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../BinaryFormat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BinaryFormat
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ExtendingDistributedRuntime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ExtendingDistributedRuntime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ExtendingSchedulingKnobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ExtendingSchedulingKnobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HandlingPRs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HandlingPRs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ImplementBuiltinKernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ImplementBuiltinKernel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profiling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WriteDocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WriteDocs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../InstallPythonLibsInContainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    InstallPythonLibsInContainer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    PropertyInference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    PropertyInference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#currently-supported-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Currently Supported Data Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#representation-of-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Representation of Data Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-property-inference" class="md-nav__link">
    <span class="md-ellipsis">
      Data Property Inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-property-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Property Exploitation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-daphnes-support-for-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Extending DAPHNE's Support for Data Properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extending DAPHNE&#39;s Support for Data Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-new-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Data Property
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-a-new-op-support-inference-for-an-existing-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Making a New Op Support Inference for an Existing Data Property
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Making a New Op Support Inference for an Existing Data Property">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-an-existing-inference-interface-to-the-op" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an Existing Inference Interface to the Op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-existing-inference-trait-to-the-op" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an Existing Inference Trait to the Op
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-new-inference-trait-for-an-existing-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Inference Trait for an Existing Data Property
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PropertyRecording/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PropertyRecording
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#currently-supported-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Currently Supported Data Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#representation-of-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Representation of Data Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-property-inference" class="md-nav__link">
    <span class="md-ellipsis">
      Data Property Inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-property-exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Property Exploitation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-daphnes-support-for-data-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Extending DAPHNE's Support for Data Properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extending DAPHNE&#39;s Support for Data Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-new-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Data Property
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-a-new-op-support-inference-for-an-existing-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Making a New Op Support Inference for an Existing Data Property
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Making a New Op Support Inference for an Existing Data Property">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-an-existing-inference-interface-to-the-op" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an Existing Inference Interface to the Op
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-existing-inference-trait-to-the-op" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an Existing Inference Trait to the Op
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-new-inference-trait-for-an-existing-data-property" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Inference Trait for an Existing Data Property
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="data-properties-representation-inference-and-exploitation">Data Properties: Representation, Inference, and Exploitation</h1>
<p>DAPHNE data objects (matrices/frames) can be described by various <em>data properties</em> (synonym: <em>data characteristics</em>), such as the data type and value type, the shape, the sparsity, the number of distinct values, the value distribution, etc.</p>
<p>Information about the data properties can be exploited for optimizing runtime and memory consumption in several ways, e.g., through:</p>
<ul>
<li><em>Simplification rewrites</em> (e.g., eliminate transpose on a symmetric matrix, eliminate row-wise sum on a single-column matrix, etc.)</li>
<li><em>Physical data/value type selection</em> (e.g., sparse representations like CSR for sparse data, compressed representations for small integers, etc.)</li>
<li><em>Physical operator/algorithm selection</em> (e.g., special algorithms on sparse data, special algorithms on sorted data, etc.)</li>
</ul>
<p>This document explains how DAPHNE handles interesting data properties and justifies why it is done this way. Furthermore, it explains how to extend DAPHNE with additional data properties.</p>
<h2 id="currently-supported-data-properties">Currently Supported Data Properties</h2>
<p>DAPHNE supports an individual set of data properties for each data type as described in the list below.
We view the data and value type as a special kind of data property.
The fact that DAPHNE supports a certain data property does not mean that the data property will be known for every SSA value; some data properties may not be inferred because (a) they simply cannot be known in a certain situation, or (b) there are gaps due to the current state of the implementation.</p>
<ul>
<li><strong>Matrix</strong><ul>
<li><em>value type:</em> the common type of all matrix elements</li>
<li><em>shape (number of rows, number of columns):</em> the logical size of the matrix</li>
<li><em>sparsity:</em> the number of non-zero elements divided by the total number of elements</li>
<li><em>symmetry:</em> whether the <em>(n x n)</em> matrix <em>X</em> is symmetric, i.e., for any <em>0 ≤ i, j ≤ n: X[i, j] = X[j, i]</em></li>
<li><em>physical representation:</em> the way the matrix is stored in memory (e.g., dense or sparse)</li>
</ul>
</li>
<li><strong>Frame</strong><ul>
<li><em>value types:</em> the array of types for each column</li>
<li><em>shape (number of rows, number of columns):</em> the logical size of the frame</li>
<li><em>column labels:</em> the array of textual labels for each column (labels must be unique for each frame)</li>
</ul>
</li>
<li><strong>Column</strong><ul>
<li><em>value type:</em> the common type of all column elements</li>
<li><em>shape (number of rows):</em> the logical size of the column</li>
</ul>
</li>
<li><strong>Scalar</strong><ul>
<li><em>(none so far)</em></li>
</ul>
</li>
</ul>
<h2 id="representation-of-data-properties">Representation of Data Properties</h2>
<p><strong>Data properties are represented in the DaphneIR and in the DAPHNE runtime.</strong>
Thus, the information on data properties is available at compile-time and at run-time.
The rationale for a compile-time representation (as opposed to a pure run-time representation) is twofold:</p>
<ul>
<li>Some ways of inferring data properties require a global view on the program.
    This global view is only available at compile-time.
    For instance, the result of <code>t(X) @ X</code> is a symmetric matrix for any matrix <code>X</code>, but that cannot easily be derived from looking at the individual ops.</li>
<li>Some ways of exploiting data properties for optimizations need to take place at compile-time, because they apply global optimizations to the IR (e.g., simplification rewrites, operator ordering, code generation, and operator fusion).</li>
</ul>
<p><strong>In DaphneIR, data properties are stored as <a href="https://mlir.llvm.org/docs/DefiningDialects/AttributesAndTypes/#parameters">parameters</a> of custom MLIR types</strong> (see <code>src/ir/daphneir/DaphneTypes.td</code>) (e.g., <code>Matrix</code>/<code>mlir::daphne::MatrixType</code> and <code>Frame</code>/<code>mlir::daphne::FrameType</code>).</p>
<p>There would have been some alternative approaches to using MLIR type parameters.
Those alternatives would not necessarily be impossible to use for the purpose of representing data properties.
However, we decided against them.
We considered the following alternatives:</p>
<ul>
<li><em>MLIR attributes on MLIR operations</em>.
    We decided against this approach, because attributes attached to ops typically denote the data properties of the op's result(s).
    We want to be able to represent data properties of any SSA value (<code>mlir::Value</code>), but not all SSA values are produced by an MLIR operation (some are block arguments).
    An operation can have multiple results, would lead to duplication of attributes.</li>
<li><em>MLIR <a href="https://mlir.llvm.org/docs/PassManagement/#analysis-management">analysis passes</a></em>.
    <strong>TODO</strong> Explain why not.</li>
</ul>
<p>Nevertheless, the chosen approach of representing data properties as MLIR type parameters also has some downsides:</p>
<ul>
<li>Data properties technically become a part of the MLIR type.
    Hence, we cannot use MLIR's type inference interface unless we make type inference always infer all data properties (which might be costly).
    However, this point is not too bad, since we have our own type inference interface.</li>
<li>As a consequence, type comparisons can have, at first glance, unexpected results (e.g., a matrix of value type <code>f64</code> with sparsity <code>0.5</code> is not the same MLIR type as matrix of value type <code>f64</code> with sparsity <code>0.1</code>).
    As a workaround, we introduced the <code>withSameValueType()</code> utility function on our custom MLIR types.
    This functions sets all data properties to <em>unknown</em> except the value type(s).
    After invoking this utility function, type comparisons will only consider the data/value type, so the comparison result should be as expected.</li>
</ul>
<p><strong>In the DAPHNE runtime, data properties are stored as member variables of DAPHNE data objects.</strong>
More precisely, the data properties are stored at the level of the data type superclasses <code>Matrix</code> and <code>Frame</code> (see <code>src/runtime/local/datastructures/Matrix.h</code> and <code>src/runtime/local/datastructures/Frame.h</code>).
The rationale for not storing data properties at the level of individual data type subclasses (such as <code>DenseMatrix</code> and <code>CSRMatrix</code>) is that data properties describe the logical data.
While certain data properties may make certain physical representations more suitable, the data properties and the physical representation of a data object can be viewed independently of each other.</p>
<p><strong>Each data property can have an <em>unknown value</em>.</strong>
After DaphneDSL parsing, most (almost all) data properties are unknown in the initial DaphneIR representation.
Through data property inference, some/many data properties can become known at compile-time, but not necessarily all.
At any point in time during compilation, a data property may not be known (yet).
By the end of the DAPHNE compiler (more precisely, by <code>RewriteToCallKernelOpPass</code>) the data/value type of all SSA values must be known (otherwise DAPHNE cannot select the right runtime kernel for the operation), except for the column value types of frames, which may remain unknown at compile-time (because the column value types of frames are interpreted dynamically at run-time).</p>
<p>For each data property, there is some special value that represents <em>unknown</em>:</p>
<ul>
<li>Data/value type: DAPHNE's custom <code>Unknown</code> type (<code>mlir::daphne::UnknownType</code>)</li>
<li>Non-negative numeric data properties (e.g., the number of rows, the number of columns, sparsity, etc.): typically <code>-1</code></li>
</ul>
<ul>
<li>Complex object-valued data properties (e.g., the array of column labels of a frame): typically <code>nullptr</code></li>
</ul>
<p><strong>The compile-time information on the data properties is also available to the runtime.</strong></p>
<ul>
<li>
<p>On the one hand, some <em>fundamental data properties</em> are anyway available at run-time, because they are part of the fundamental meta data of the runtime data structures:
    </p>
<ul>
<li><strong>Matrix</strong><ul>
<li>value type (usually as a template parameter of a kernel)</li>
<li>shape (number of rows, number of columns)</li>
</ul>
</li>
<li><strong>Frame</strong><ul>
<li>column value types</li>
<li>column labels</li>
</ul>
</li>
</ul>
<p>Even in case these data properties are not known at compile-time for a particular intermediate result, they are <em>always</em> known at run-time <em>at no extra cost</em>.</p>
</li>
<li>
<p>On the other hand, there are some <em>additional data properties</em>, whose analysis would incur non-negligible extra effort at run-time:</p>
<ul>
<li><strong>Matrix</strong><ul>
<li>sparsity</li>
<li>symmetry</li>
</ul>
</li>
</ul>
<p>So far, these properties are not analyzed at run-time due to the implied extra cost.
Instead, the compile-time information on these properties is transferred to the runtime data objects.
To this end, there is a dedicated compiler pass, <code>TransferDataPropertiesPass</code> (see <code>src/compiler/inference/TransferDataPropertiesPass.cpp</code>), which inserts a <code>TransferPropertiesOp</code> (see <code>src/ir/daphneir/DaphneOps.td</code>) for every matrix-valued op result.
The op gets a matrix as well as the scalar values of the data properties mentioned above as its arguments.
The compiler pass extracts the values of the data properties (which may be unknown) from the MLIR types and wraps them in <code>ConstantOp</code>s, which become the arguments of the <code>TransferPropertiesOp</code>.
Like most DaphneIR operations, <code>TransferPropertiesOp</code> gets lowered to a kernel call; the corresponding <code>transferProperties</code>-kernel can be found in <code>src/runtime/local/kernels/TransferProperties.h</code>.</p>
</li>
</ul>
<h2 id="data-property-inference">Data Property Inference</h2>
<p>At compile-time, DAPHNE tries to find out the data properties of intermediate results in the IR.
This process is called <em>property inference</em> (synonyms: <em>property propagation</em>, <em>property estimation</em>).
The basic idea is to infer the data properties of an op's results from the data properties of the op's arguments (and, perhaps, from compile-time constant argument values).
Currently, DAPHNE does this inference only at the level of each individual op.
In the future, it could also infer data properties for patterns/DAGs of ops (e.g., the result of <code>t(X) @ X</code> is a symmetric matrix for any matrix <code>X</code>, which can hardly be inferred based on the individual ops <code>t</code> and <code>@</code>).</p>
<p><strong>The compiler pass responsible for data property inference is the <code>InferencePass</code></strong> (<code>src/compiler/inference/InferencePass.cpp</code>).
Besides that, <code>SelectMatrixRepresentationsPass</code> (<code>src/compiler/inference/SelectMatrixRepresentationsPass.cpp</code>) also plays a role as it selects the physical matrix representation (dense/sparse) based on the estimated sparsity, but maybe we will factor it into <code>InferencePass</code> in the future.</p>
<p><strong>Procedure for data property inference.</strong>
The <code>InferencePass</code> walks the IR op by op and tries to infer all data properties for all results of the current op before moving on to the next op.</p>
<p>The rationale for this <em>"for each op: for each prop: infer"</em>-procedure rather than a <em>"for each prop: for each op: infer"</em>-procedure is that a data property <em>X</em> of an op's result does not always depend on the data property <em>X</em> of the op's argument(s), but sometimes on another data property <em>Y</em> of the argument(s).
For instance, the number of rows of the result of <code>FilterRowOp</code> depends on the sparsity of the input bit vector.
Thus, before inferring any data property of the result of an op, we should have as much information on all data properties of the argument(s) of the op as possible.</p>
<p>Given a certain op, the <code>InferencePass</code> considers the supported data properties one by one.
If the value of a data property is unknown for any result of the op, the inference logic for this data property on this op is invoked.
The rationale for not re-inferring already known data properties is efficiency.</p>
<p><strong>The op-specific inference of data properties is handled by custom MLIR <a href="https://mlir.llvm.org/docs/Interfaces/">interfaces</a> and <a href="https://mlir.llvm.org/docs/Traits/">traits</a>.</strong>
By default, there is one custom MLIR interface per supported data property.
The functions defined by the interface become part of the op the interface is attached to.
The interface returns the inferred value of the data property (usually some kind of list, e.g., a <code>std::vector</code>, because an op can have multiple results).</p>
<p>The rationale for not making the interface set the data property on the results of the op are as follows:
(1) The logic for setting the data property value would need to be redundantly implemented by every single interface implementation.
Even though this logic is usually just a one-liner, there is a potential for bugs.
Moreover, one would hard-code the way data properties are represented (e.g., type parameters vs. attributes) in every single interface implementation.
(2) We want a single point of insertion into the IR, because data properties could also be inferred by traits (see below).</p>
<p>The <strong>source files involved in the inference interface of a data property</strong> <code>${prop}</code> are the following (look at the files of some existing data property for the details):</p>
<ul>
<li><code>src/ir/daphneir/DaphneInfer${prop}OpInterface.td</code><ul>
<li>A TableGen-based declaration of the custom MLIR interface.</li>
<li>Typically the interface defines a single function <code>infer${prop}()</code>.</li>
<li>In justified cases, there can be multiple interfaces.
    For instance, the interface for shape inference comes with separate interfaces for the inference of the number of rows and columns (because sometimes, just one of the two dimensions can be expressed by a trait, see below).</li>
</ul>
</li>
<li><code>src/ir/daphneir/DaphneInfer${prop}OpInterface.h</code><ul>
<li>Defines the custom MLIR traits for this data property (C++ part).</li>
<li>Include the TableGen'erated header file <code>ir/daphneir/DaphneInfer${prop}OpInterface.h.inc</code></li>
<li>Declares the function <code>tryInfer${prop}(mlir::Operation *op)</code>.
    (Type inference also has a function <code>setInferredTypes()</code>, because we want to set the data/value type also in the parser and compiler passes.)</li>
</ul>
</li>
<li><code>src/ir/daphneir/DaphneInfer${prop}OpInterface.cpp</code><ul>
<li>Op-specific implementations of the inference interface, i.e., functions <code>${op}::infer${prop}()</code> (for an op <code>${op}</code>).</li>
<li>Trait implementations.</li>
<li>Definition of <code>tryInfer${prop}(mlir::Operation *op)</code>.
    This function first checks if op has the respective inference interface; if so, it calls <code>infer${prop}()</code> on the op.
    Otherwise: it checks if the op has exactly one result and a related inference trait; if so, it applies the trait.
    Otherwise: it sets the data property to unknown for all results.
    </li>
</ul>
</li>
</ul>
<p>In fact, many ops have a quite similar implementation of an inference interface.
Thus, we use <strong>custom <a href="https://mlir.llvm.org/docs/Traits/">MLIR traits</a></strong> to express common inference behavior.
Traits can refer to the entire data property or an aspect of it.
For instance, type inference has some traits that express how to infer the complete data and value type, and some traits for either the data or the value type (for better reuse of traits).</p>
<p>The <strong>source files involved in the inference traits of a data property</strong> <code>${prop}</code> are the following (again, see concrete examples in the code for more details):</p>
<ul>
<li><code>src/ir/daphneir/DaphneInfer{$prop}Traits.td</code><ul>
<li>TableGen-based definition of custom (parametric) MLIR traits; essentially just references to the C++ part in <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.h</code>.</li>
</ul>
</li>
</ul>
<p><strong>Property inference and control flow constructs.</strong></p>
<p><strong>TODO</strong></p>
<p><strong>Relation to constant folding.</strong>
In the DAPHNE compilation chain, data property inference is executed multiple times and interleaved with the MLIR <code>CanonicalizationPass</code>.</p>
<p>The rationale for this repetition and interleaving is that <a href="https://mlir.llvm.org/docs/Canonicalization/">canonicalization</a> includes <a href="https://mlir.llvm.org/docs/Canonicalization/#canonicalizing-with-the-fold-method">constant folding</a>, i.e., calculating the result of an op at compile-time if all inputs are compile-time constants.
On the one hand, the result <em>value</em> of some ops depends on a <em>data property</em> of an argument (e.g., for <code>NumRowsOp</code>, the result value is the argument's number of rows).
On the other hand, a result <em>data property</em> of some ops depends on an argument <em>value</em> (e.g., for <code>FillOp</code>, the result shape is given by argument values).
Thus, data property inference and constant folding depend on each other.</p>
<p><strong>Viewing the data properties inferred by the DAPHNE compiler</strong> is possible through DAPHNE's explain functionality.
When invoking DAPHNE with the argument <code>--explain property_inference</code>, the IR after data property inference is printed.
The data properties of an SSA value are displayed as a part of its type, whereby the concrete syntax is determined by <code>mlir::daphne::DaphneDialect::printType()</code> (see <code>src/ir/daphneir/DaphneDialect.cpp</code>).</p>
<p><strong>Command-line arguments related to data property inference.</strong></p>
<ul>
<li><code>--select-matrix-repr</code>
    Makes DAPHNE use the estimated sparsities of intermediate results for selecting a suitable physical representation of a matrix (especially <code>DenseMatrix</code> vs. <code>CSRMatrix</code>) and, hence, the respective kernels, e.g., those for <code>CSRMatrix</code>.
    Currently, <em>DAPHNE will only use sparse representations and kernels if this argument is provided</em>, because sparsity support is still experimental in some respects.
    In the future, sparsity support will be on by default.</li>
<li><code>--explain property_inference</code>
    Makes DAPHNE print the IR after data property inference (see above).</li>
</ul>
<p><strong>Relation to file meta data.</strong></p>
<p><strong>TODO</strong></p>
<h2 id="data-property-exploitation">Data Property Exploitation</h2>
<p><strong>TODO</strong></p>
<h2 id="extending-daphnes-support-for-data-properties">Extending DAPHNE's Support for Data Properties</h2>
<p>DAPHNE's support for data properties can be extended by modifying the source code straightforwardly.
This section provides step-by-step instructions for typical tasks, summarizing what needs to be done in which files.
We focus on giving high-level explanations and pointers; for the details, the existing code (which contains several examples of data properties) can be used as a blueprint.
Furthermore, the <a href="https://mlir.llvm.org/docs/">MLIR documentation</a> provides more detailed information on how to do various things in MLIR.</p>
<h3 id="adding-a-new-data-property">Adding a New Data Property</h3>
<p>New data properties can be added to DAPHNE's abstract data types (matrix, frame, etc.).
Before adding a new data property called <code>${prop}</code>, think about (a) which DAPHNE data type you want to add the data property to (e.g., matrix or frame), and (b) of what C++ type the new data property shall be (e.g., <code>ssize_t</code>, <code>double</code>, <code>mlir::Type</code>, some custom C++ enum class, or some custom C++ class).
If the new data property shall be of a custom C++ type, add this new type to <code>src/ir/DataPropertyTypes.h</code> (or use one of the existing types there). In particular, if the new property shall have a small set of discrete values, you can use an enum class as the C++ type of the new data property.
In the following, we assume the new data property is of C++ type <code>${pt}</code> and we want to add it to the DAPHNE data type <code>${dt}</code>.
The following steps are required (commit da35f1eb197c5e993167d6c2862d98a513b40852 is an example for adding a new data property; however, note that some details of adding a new data property have evolved since this commit):</p>
<p><em>Support for <code>${prop}</code> in the DAPHNE compiler:</em></p>
<ol>
<li>Add a new <a href="https://mlir.llvm.org/docs/DefiningDialects/AttributesAndTypes/#parameters">parameter</a> <code>${prop}</code> to the custom MLIR type <code>${dt}</code> in <code>src/ir/daphneir/DaphneTypes.td</code>.</li>
<li>Adapt <code>mlir::daphne::detail::${dt}TypeStorage</code> (see <code>src/ir/daphneir/DaphneDialect.cpp</code>) by adding the new data property.
    In particular, update the constructor, the member functions <code>operator==()</code>, <code>hashKey()</code>, and <code>construct()</code>, and add a member variable for the new data property.</li>
<li>Add the default value (usually the <em>unknown</em> value) of the new data property to the custom builder in the <code>builders</code> section of the custom MLIR type <code>${dt}</code>.</li>
<li>Update the custom methods in the <a href="https://mlir.llvm.org/docs/DefiningDialects/Operations/#extra-declarations"><code>extraClassDeclaration</code></a> of the custom MLIR type <code>${dt}</code>:<ul>
<li>Add a method <code>with${prop}(${pt} ${prop})</code> that gets a value for the new data property and returns an instance of the MLIR type that sets the value of the new data property to the given value and retains the current value for all other data properties of <code>${dt}</code>.</li>
<li>Add a call to <code>get${prop}()</code> to all other <code>with*(...)</code> methods such that they retain the current value of the new data property <code>${prop}</code>.</li>
<li>Take the new data property into account in <code>isSpecializationOf(...)</code>.</li>
</ul>
</li>
<li>Update the method <code>mlir::daphne::${dt}Type::verify(...)</code> (see <code>src/ir/daphneir/DaphneDialect.cpp</code>) by adding a validity check for the value of the new data property <code>${prop}</code>.
    This step is necessary only if the C++ type <code>${pt}</code> contains any values that are not valid for the data property <code>${prop}</code> or if any values might conflict with the values of other data properties.</li>
<li>Make sure the new data property gets represented in the textual IR, such that it is displayed, e.g., when running <code>bin/daphne --explain property_inference</code>, (optional step, but highly recommended).
    To that end, take the data property into account in <code>mlir::daphne::DaphneDialect::printType()</code> and <code>mlir::daphne::DaphneDialect::parseType()</code> (see <code>src/ir/daphneir/DaphneDialect.cpp</code>).</li>
<li>Create the inference interface for <code>${prop}</code>.<ul>
<li>Add the files <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.td</code>, <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.h</code>, and <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.cpp</code>.
    See the description <a href="#data-property-inference">above</a> for more details on the meaning of these files.
    The existing files of other data properties can be used as blueprints (up to this point, you don't need any interface implementations for specific ops and you don't need any inference traits).</li>
<li>Update <code>src/ir/daphneir/CMakeLists.txt</code>: Add a line <code>add_mlir_interface(DaphneInfer${prop}OpInterface)</code> and add the <code>.cpp</code> file.</li>
<li>Add the include <code>#include &lt;ir/daphneir/DaphneInfer${prop}OpInterface.h&gt;</code> to <code>src/ir/daphneir/Daphne.h</code>.</li>
<li>Add the line <code>include "ir/daphneir/DaphneInfer${prop}OpInterface.td"</code> to the top of <code>src/ir/daphneir/DaphneOps.td</code> for future use.</li>
</ul>
</li>
<li>Make the <code>InferencePass</code> consider the new data property (see <code>src/compiler/inference/InferencePass.cpp</code>):<ul>
<li>Update <code>daphne::InferenceConfig::InferenceConfig</code>.
    Update <code>struct InferenceConfig</code> as well as the line <code>std::unique_ptr&lt;Pass&gt; createInferencePass(...)</code> in <code>src/ir/daphneir/Passes.h</code> accordingly.
    Update the lines <code>pm.addPass(daphne::createInferencePass(...));</code> in <code>src/compiler/lowering/SpecializeGenericFunctionsPass.cpp</code> accordingly.</li>
<li>Update the function <code>getTypeWithCommonInfo()</code>.</li>
<li>Update the lambda <code>walkOp</code>: In the then-branch of <code>if (!isScfOp)</code> (if the current op is not a control flow operation), there is a sequence of if-statements, one for each supported data properties.
    Add an if-statement for the new data property <code>${prop}</code> akin to the existing ones here.
    In that context, you will most likely want to add a new helper function <code>returnsUnknown${prop}()</code> for the new data property akin to the existing ones.</li>
</ul>
</li>
</ol>
<p><em>Support for <code>${prop}</code> in the DAPHNE runtime:</em></p>
<ol>
<li>Add a member variable for <code>${prop}</code> in the runtime class corresponding to <code>${dt}</code> (e.g., in <code>src/runtime/local/datastructures/Matrix.h</code> or <code>src/runtime/local/datastructures/Frame.h</code>).
    This member variable should be of the C++ type <code>${pt}</code>.
    Ensure that the constructor of the class initializes the new member variable to the unknown value of <code>${prop}</code>.</li>
<li>Add a new argument for <code>${prop}</code> to the definition of the DaphneIR op <code>TransferPropertiesOp</code> in <code>src/ir/daphneir/DaphneOps.td</code>.
    Update the corresponding kernel <code>transferProperties</code> (<code>src/runtime/local/kernels/TransferProperties.h</code>) accordingly by adding a new argument for <code>${prop}</code> to the kernel; the kernel should set the new member variable on the argument to the provided value.
    Reflect the additional kernel argument in <code>src/runtime/local/kernels/kernels.json</code>.</li>
<li>Update <code>TransferDataPropertiesPass</code> (<code>src/compiler/inference/TransferDataPropertiesPass.cpp</code>) by extracting the value of <code>${prop}</code> from the MLIR type and passing it as an argument to the <code>TransferPropertiesOp</code> created by this pass.</li>
</ol>
<p><em>Documentation:</em></p>
<ol>
<li>Update the documentation on data properties (this document, <code>doc/development/PropertyInference.md</code>) by mentioning <code>${prop}</code> in the list of supported data properties at the top of the page.</li>
</ol>
<h3 id="making-a-new-op-support-inference-for-an-existing-data-property">Making a New Op Support Inference for an Existing Data Property</h3>
<p>To enable the op <code>${op}</code> to infer the data property <code>${prop}</code> for its result(s), we can either add the respective inference interface or an existing related inference trait to the TableGen record of the op <code>${op}</code> in <code>src/ir/daphneir/DaphneOps.td</code>.</p>
<h4 id="adding-an-existing-inference-interface-to-the-op">Adding an Existing Inference Interface to the Op</h4>
<ol>
<li>Add the item <code>DeclareOpInterfaceMethods&lt;Infer${prop}OpInterface&gt;</code> to the definition of <code>${op}</code> in <code>src/ir/daphneir/DaphneOps.td</code> (see other ops for examples).</li>
<li>Make sure that <code>src/ir/daphneir/DaphneOps.td</code> has an include <code>include "ir/daphneir/DaphneInfer${prop}OpInterface.td"</code>.</li>
<li>Add the C++ implementation of the inference interface in <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.cpp</code>.<ul>
<li>Remember that any data property of any argument could have an unknown value.</li>
<li>Take inspiration from the existing inference interface implementations (of this or another data property).</li>
</ul>
</li>
</ol>
<p>Commit 4b120162ae26a2af1906f51fed48661926c87a48 is an example.</p>
<h4 id="adding-an-existing-inference-trait-to-the-op">Adding an Existing Inference Trait to the Op</h4>
<ol>
<li>To add the inference trait <code>${trait}</code>, add the item <code>${trait}</code> to the definition of <code>${op}</code> in <code>src/ir/daphneir/DaphneOps.td</code> (see other ops for examples).</li>
<li>Make sure that <code>src/ir/daphneir/DaphneOps.td</code> has an include <code>include "ir/daphneir/DaphneInfer${prop}Traits.td"</code>.</li>
</ol>
<h3 id="adding-a-new-inference-trait-for-an-existing-data-property">Adding a New Inference Trait for an Existing Data Property</h3>
<p>It is not uncommon that multiple ops share a quite similar way of inferring the value of a data property <code>${prop}</code> of their result(s).
Rather than writing essentially the same inference interface implementation multiple times for these ops, we can optionally add a custom MLIR <a href="https://mlir.llvm.org/docs/Traits/">trait</a> that expresses how the inference works.
That way, we can make the source code simpler and easier to maintain.
The following steps are required:</p>
<ol>
<li>
<p>Create a new trait.</p>
<ul>
<li>
<p>Add the C++ part of the trait in <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.h</code>.
    That is, something like:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">// Example: Always infer ${prop} as 123 (non-parametric trait).</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">ConcreteOp</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">$</span><span class="p">{</span><span class="n">prop</span><span class="p">}</span><span class="mi">123</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TraitBase</span><span class="o">&lt;</span><span class="n">ConcreteOp</span><span class="p">,</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">prop</span><span class="p">}</span><span class="mi">123</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">// Example: Retain the property value from the i-th argument (parametric trait).</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">mlir</span><span class="o">::</span><span class="nn">OpTrait</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">$</span><span class="p">{</span><span class="n">prop</span><span class="p">}</span><span class="n">FromIthArg</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">ConcreteOp</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Impl</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TraitBase</span><span class="o">&lt;</span><span class="n">ConcreteOp</span><span class="p">,</span><span class="w"> </span><span class="n">Impl</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">};</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">}</span><span class="w"> </span><span class="c1">// namespace mlir::OpTrait</span>
</code></pre></div>
    - Create the file <code>src/ir/daphneir/DaphneInfer${prop}Traits.td</code>, if it doesn't exist yet.
Furthermore, add an include of this <code>.td</code> file in <code>src/ir/daphneir/DaphneOps.td</code> such that the inference traits for data property <code>${prop}</code> can be attached to ops.
    - Write the TableGen part of the trait in <code>src/ir/daphneir/DaphneInfer${prop}Traits.td</code>.
That is, something like:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>// For non-parametric traits.
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>def ${prop}123 : NativeOpTrait&lt;&quot;${prop}123&quot;&gt;;
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>// For parametric traits.
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>class ${prop}FromIthArg&lt;int i&gt; : ParamNativeOpTrait&lt;&quot;${prop}FromIthArg&quot;, !cast&lt;string&gt;(i)&gt;;
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>def ${prop}FromArg : ${prop}FromIthArg&lt;0&gt;; // short form for a concrete value of i
</code></pre></div>
1. Implement the effect the trait should have during data property inference.
    We need to make the DAPHNE compiler know how to infer data property <code>${prop}</code> for ops that have the newly added trait.
    To that end, we need to:</p>
</li>
<li>
<p>Update the function <code>tryInfer${prop}(mlir::Operation *op)</code> (see <code>src/ir/daphneir/DaphneInfer${prop}OpInterface.cpp</code>) such that it checks for the presence of the new trait and reacts accordingly.
    You can check for a non-parametric trait by, e.g., <code>op-&gt;hasTrait&lt;${prop}123&gt;()</code>.
    For parametric traits, you can only check for the trait including a concrete value of the parameter, e.g., <code>op-&gt;hasTrait&lt;${prop}FromIthArg&lt;0&gt;&gt;</code>.
    To check for a range of values of a trait parameter, we frequently use a custom utility <code>tryParamTraitUntil</code>; see the code for details.</p>
</li>
</ul>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>